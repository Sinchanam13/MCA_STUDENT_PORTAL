<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploaded Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans p-6">
    <header
        class="sticky top-0 z-10 flex w-full items-center justify-center border-b border-slate-200/80 bg-background-light/80 backdrop-blur-sm dark:border-slate-800/80 dark:bg-background-dark/80">
        <div class="flex w-full max-w-7xl items-center justify-between whitespace-nowrap px-4 py-3 sm:px-6 lg:px-8">
            <div class="flex items-center gap-8">
                <div class="flex items-center gap-3 text-slate-900 dark:text-slate-50">

                    <!-- Logo image -->
                    <img src="logo.webp" alt="MCA Department Logo" class="h-14 w-auto object-contain">

                    <!-- Department name -->
                    <h2 class="text-lg font-bold tracking-[-0.015em]">
                        MCA Department
                    </h2>

                </div>
            </div>

            <nav class="hidden items-center gap-9 md:flex">
                <a class="text-sm font-medium text-primary" href="home.html">Dashboard</a>
                <a class="text-sm font-medium text-slate-600 hover:text-primary dark:text-slate-300 dark:hover:text-primary"
                    href="research.html">Research Paper</a>
                <a class="text-sm font-medium text-slate-600 hover:text-primary dark:text-slate-300 dark:hover:text-primary"
                    href="project.html">Project</a>
            </nav>
        </div>
        <div class="flex flex-1 items-center justify-end gap-4">

            <div class="h-10 w-10 shrink-0">
                <img class="h-full w-full rounded-full object-cover" data-alt="Student profile picture"
                    src="https://lh3.googleusercontent.com/aida-public/AB6AXuBHrISuoZvl1hIAC2Xzxz-ZgYwc5cMyzKwvWUG_5DWGOmhPoMSOXTIeisRv1r9NCrZibfVn6RZMDjgvWxFvkd62I4U8z5mkKIL1xfA-GUivQrIx6PG-vKi2OUObXT4-Gg7eKXrkdZQy_N9m55PYvEzx0UR5qtR5mCjlhXKRtPNdu_ebH2ald5YrX_HuYKfWmihmAC43xmwc70YgBsDLDMJgNsQ9kf9kl65Mtp6oJcvVTU1tbLM5NBb0QCvFihPkVNHHmTY_PyUvlaw1" />
            </div>
        </div>
        </div>
    </header>

    <div class="max-w-5xl mx-auto">

        <h1 class="text-3xl font-bold text-center mb-6">Uploaded Notes</h1>

        <!-- Semester & Subject Filter -->
        <div class="flex flex-col md:flex-row gap-4 justify-center mb-6">
            <div>
                <label class="block font-medium mb-1">Semester</label>
                <select id="semester" class="p-2 border rounded w-full md:w-48">
                    <option value="">All Semesters</option>
                    <option value="sem1">Semester 1</option>
                    <option value="sem2">Semester 2</option>
                    <option value="sem3">Semester 3</option>
                    <option value="sem4">Semester 4</option>
                </select>
            </div>
            <div>
                <label class="block font-medium mb-1">Subject</label>
                <select id="subject" class="p-2 border rounded w-full md:w-48" disabled>
                    <option value="">Select Semester First</option>
                </select>
            </div>
            <button id="filterBtn"
                class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 self-end mt-4 md:mt-6">
                Filter
            </button>
        </div>

        <!-- Notes Grid -->
        <div id="noteList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 justify-center">
            Loading notes...
        </div>
    </div>

    <script>
        // Semester -> Subjects mapping
        const subjectsMap = {
            sem1: ["C", "Python", "Java"],
            sem2: ["Machine Learning", "DBMS", "Data Structures"],
            sem3: ["Cyber Security", "AI", "ML Specialization"],
            sem4: ["Cloud Computing", "Blockchain", "DevOps"]
        };

        const semesterSelect = document.getElementById("semester");
        const subjectSelect = document.getElementById("subject");
        const noteList = document.getElementById("noteList");

        // Populate subjects when semester changes
        semesterSelect.addEventListener("change", () => {
            const sem = semesterSelect.value;
            subjectSelect.innerHTML = "";
            if (!sem) {
                subjectSelect.disabled = true;
                subjectSelect.innerHTML = "<option value=''>Select Semester First</option>";
                return;
            }
            subjectSelect.disabled = false;
            const options = subjectsMap[sem].map(sub => `<option value="${sub}">${sub}</option>`).join("");
            subjectSelect.innerHTML = `<option value="">All Subjects</option>` + options;
        });

        // Fetch and display notes
        async function fetchNotes() {
            noteList.innerHTML = "Loading notes...";

            const semester = semesterSelect.value;
            const subject = subjectSelect.value;

            let url = "http://localhost:5000/api/notes/all";
            const query = [];
            if (semester) query.push(`semester=${semester}`);
            if (subject) query.push(`subject=${subject}`);
            if (query.length) url += "?" + query.join("&");

            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error("Failed to fetch notes");

                const notes = await res.json();

                if (!notes || notes.length === 0) {
                    noteList.innerHTML = `<p class="text-center col-span-full text-gray-500">No notes found.</p>`;
                    return;
                }

                noteList.innerHTML = "";
                notes.forEach(note => {
                    const div = document.createElement("div");
                    div.className = "bg-white rounded-lg shadow p-4 flex flex-col items-center";
                    div.innerHTML = `
                <div class="w-16 h-16 bg-red-500 text-white flex items-center justify-center font-bold rounded mb-3">PDF</div>
                <div class="font-semibold text-center mb-2">${note.title}</div>
                <div class="text-sm text-gray-500 mb-3">Uploaded: ${new Date(note.createdAt).toLocaleString()}</div>
                <a href="http://localhost:5000/api/notes/download/${note._id}" 
                   class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition"
                   download="${note.fileName}">Download</a>
            `;
                    noteList.appendChild(div);
                });
            } catch (err) {
                console.error(err);
                noteList.innerHTML = `<p class="text-center col-span-full text-red-500">Error loading notes.</p>`;
            }
        }

        // Initial fetch
        fetchNotes();

        // Filter button click
        document.getElementById("filterBtn").addEventListener("click", fetchNotes);
    </script>
</body>

</html>