<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Research Papers</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 p-6">

    <h1 class="text-3xl font-bold text-center mb-6">Research Papers</h1>

    <div id="researchGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
    <p id="statusMsg" class="text-center mt-4 text-primary"></p>

    <script>
        async function loadResearch() {
            const grid = document.getElementById("researchGrid");
            const statusMsg = document.getElementById("statusMsg");
            try {
                statusMsg.textContent = "⏳ Loading research papers...";

                const res = await fetch("http://localhost:5000/api/research/all");
                if (!res.ok) throw new Error("Failed to fetch research");

                const data = await res.json();

                // If your backend returns { research: [...] }
                const researchList = Array.isArray(data) ? data : data.research;

                grid.innerHTML = "";

                if (!researchList || researchList.length === 0) {
                    statusMsg.textContent = "No research uploaded yet.";
                    return;
                }

                researchList.forEach(r => {
                    const card = document.createElement("div");
                    card.className = "bg-white p-5 rounded-lg shadow flex flex-col justify-between";

                    card.innerHTML = `
                        <h3 class="font-bold text-lg mb-2">${r.title}</h3>
                        ${r.description ? `<p class="text-sm text-gray-600 mb-4">${r.description}</p>` : ""}
                        <p class="text-xs text-gray-400 mb-3">Uploaded: ${new Date(r.createdAt).toLocaleDateString()}</p>
                        <a href="http://localhost:5000/api/research/download/${r._id}"
                           class="mt-auto inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                           Download PDF
                        </a>
                    `;
                    grid.appendChild(card);
                });

                statusMsg.textContent = "";

            } catch (err) {
                console.error(err);
                statusMsg.textContent = "❌ Failed to load research papers.";
            }
        }

        window.addEventListener("DOMContentLoaded", loadResearch);
    </script>

</body>

</html>