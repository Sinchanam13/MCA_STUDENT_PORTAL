<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Notes / Research Paper</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans p-6">

    <div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
        <h2 class="text-2xl font-bold mb-4 text-center">Upload Notes / Research Paper</h2>

        <form id="uploadForm" class="space-y-4">

            <!-- Semester & Subject -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block font-medium mb-1">Semester</label>
                    <select id="semester" required class="w-full p-2 border rounded">
                        <option value="">Select Semester</option>
                        <option value="sem1">Semester 1</option>
                        <option value="sem2">Semester 2</option>
                        <option value="sem3">Semester 3</option>
                        <option value="sem4">Semester 4</option>
                    </select>
                </div>
                <div>
                    <label class="block font-medium mb-1">Subject</label>
                    <select id="subject" required class="w-full p-2 border rounded" disabled>
                        <option value="">Select Semester First</option>
                    </select>
                </div>
            </div>

            <!-- Title -->
            <div>
                <label class="block font-medium mb-1">Title</label>
                <input type="text" id="title" required placeholder="Paper Title" class="w-full p-2 border rounded">
            </div>

            <!-- Drag & Drop File Upload -->
            <div id="dropArea"
                class="w-full p-10 border-2 border-dashed border-gray-400 rounded text-center text-gray-500 cursor-pointer hover:border-blue-500 hover:text-blue-500 transition text-lg">
                <span id="dropText">Drag & Drop your PDF here or click to select</span>
                <input type="file" id="file" name="file" accept=".pdf" required class="hidden">
            </div>

            <!-- Submit -->
            <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">
                Upload
            </button>

            <!-- Message -->
            <p id="msg" class="text-center mt-2 text-red-500"></p>

        </form>
    </div>

    <script>
        // Subjects mapping
        const subjectsMap = {
            sem1: ["C", "Python", "Java"],
            sem2: ["Machine Learning", "DBMS", "Data Structures"],
            sem3: ["Cyber Security", "AI", "ML Specialization"],
            sem4: ["Cloud Computing", "Blockchain", "DevOps"]
        };

        const semesterSelect = document.getElementById("semester");
        const subjectSelect = document.getElementById("subject");
        const msg = document.getElementById("msg");
        const dropArea = document.getElementById("dropArea");
        const fileInput = document.getElementById("file");
        const dropText = document.getElementById("dropText");

        // Enable subjects when semester is selected
        semesterSelect.addEventListener("change", () => {
            const sem = semesterSelect.value;
            subjectSelect.innerHTML = "";
            if (!sem) {
                subjectSelect.disabled = true;
                subjectSelect.innerHTML = "<option value=''>Select Semester First</option>";
                return;
            }
            subjectSelect.disabled = false;
            const options = subjectsMap[sem].map(sub => `<option value="${sub}">${sub}</option>`).join("");
            subjectSelect.innerHTML = `<option value="">Select Subject</option>` + options;
        });

        // Drag & Drop handlers
        dropArea.addEventListener("click", () => fileInput.click());

        dropArea.addEventListener("dragover", (e) => {
            e.preventDefault();
            dropArea.classList.add("border-blue-500", "text-blue-500");
        });

        dropArea.addEventListener("dragleave", (e) => {
            e.preventDefault();
            dropArea.classList.remove("border-blue-500", "text-blue-500");
        });

        dropArea.addEventListener("drop", (e) => {
            e.preventDefault();
            dropArea.classList.remove("border-blue-500", "text-blue-500");
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                if (file.type !== "application/pdf") {
                    msg.textContent = "Only PDF files are allowed";
                    dropText.textContent = "Drag & Drop your PDF here or click to select";
                    return;
                }
                fileInput.files = e.dataTransfer.files;
                dropText.textContent = `Selected File: ${file.name}`;
                msg.textContent = "";
            }
        });

        // Show file name when selected via click
        fileInput.addEventListener("change", () => {
            if (fileInput.files.length > 0) {
                dropText.textContent = `Selected File: ${fileInput.files[0].name}`;
                msg.textContent = "";
            }
        });

        // Form submission
        document.getElementById("uploadForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const file = fileInput.files[0];
            const title = document.getElementById("title").value;
            const semester = semesterSelect.value;
            const subject = subjectSelect.value;

            if (!file) { msg.textContent = "Please select a file"; return; }

            const formData = new FormData();
            formData.append("file", file);
            formData.append("title", title);
            formData.append("semester", semester);
            formData.append("subject", subject);

            msg.textContent = "Uploading...";
            msg.classList.remove("text-red-500", "text-green-500");

            try {
                const res = await fetch("http://localhost:5000/api/notes/upload", {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();

                if (res.ok) {
                    msg.textContent = "Upload successful ✅";
                    msg.classList.remove("text-red-500");
                    msg.classList.add("text-green-500");
                    e.target.reset();
                    dropText.textContent = "Drag & Drop your PDF here or click to select";
                    subjectSelect.disabled = true;
                } else {
                    msg.textContent = data.message || "Upload failed ❌";
                    msg.classList.remove("text-green-500");
                    msg.classList.add("text-red-500");
                }
            } catch (err) {
                console.error(err);
                msg.textContent = "Server error ❌";
                msg.classList.remove("text-green-500");
                msg.classList.add("text-red-500");
            }
        });
    </script>

</body>

</html>